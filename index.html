<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Backrooms 3D</title>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas { display: block; }
  </style>
</head>
<body>
  <!-- No button needed, game will load immediately -->
  
  <!-- Local file paths -->
  <script src="three.min.js"></script>
  <script src="PointerLockControls.js"></script>

  <script>
    let camera, scene, renderer, controls;
    const keys = {};

    init();
    animate();

    function init() {
      scene = new THREE.Scene();
      scene.fog = new THREE.Fog(0xffffcc, 5, 50);

      camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
      camera.position.y = 5;

      renderer = new THREE.WebGLRenderer();
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      // Light
      const light = new THREE.PointLight(0xffffaa, 1, 100);
      light.position.set(0, 10, 0);
      scene.add(light);

      // Floor
      const floorMaterial = new THREE.MeshBasicMaterial({ color: 0xffee88 });
      const floor = new THREE.Mesh(new THREE.PlaneGeometry(500, 500), floorMaterial);
      floor.rotation.x = -Math.PI / 2;
      scene.add(floor);

      // Random walls
      const wallMaterial = new THREE.MeshBasicMaterial({ color: 0xffff88 });
      for (let i = 0; i < 150; i++) {
        const wall = new THREE.Mesh(new THREE.BoxGeometry(10, 10, 1), wallMaterial);
        wall.position.set(
          Math.floor(Math.random() * 100 - 50) * 5,
          5,
          Math.floor(Math.random() * 100 - 50) * 5
        );
        wall.rotation.y = Math.random() > 0.5 ? 0 : Math.PI / 2;
        scene.add(wall);
      }

      // Controls
      controls = new THREE.PointerLockControls(camera, document.body);

      // Try to lock the pointer as soon as the page is loaded
      document.body.requestPointerLock = document.body.requestPointerLock || document.body.mozRequestPointerLock;

      // Automatically request pointer lock when the page is clicked
      document.body.addEventListener('click', () => {
        if (document.body.requestPointerLock) {
          document.body.requestPointerLock();
        }
      });

      document.addEventListener('pointerlockchange', onPointerLockChange, false);
      document.addEventListener('mozpointerlockchange', onPointerLockChange, false);

      function onPointerLockChange() {
        if (document.pointerLockElement === document.body || document.mozPointerLockElement === document.body) {
          console.log("Pointer locked");
        } else {
          console.log("Pointer unlocked");
        }
      }

      scene.add(controls.getObject());

      // Movement
      document.addEventListener('keydown', (e) => keys[e.code] = true);
      document.addEventListener('keyup', (e) => keys[e.code] = false);
    }

    function animate() {
      requestAnimationFrame(animate);

      if (controls.isLocked) {
        let moveSpeed = 0.2;
        if (keys['KeyW']) controls.moveForward(moveSpeed);
        if (keys['KeyS']) controls.moveForward(-moveSpeed);
        if (keys['KeyA']) controls.moveRight(-moveSpeed);
        if (keys['KeyD']) controls.moveRight(moveSpeed);
      }

      renderer.render(scene, camera);
    }

    window.addEventListener('resize', () => {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>
